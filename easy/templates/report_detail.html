<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    {% load static %}
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">

    <link rel="stylesheet" href="{% static 'layui2.5.5/css/layui.css' %}">
    <link rel="stylesheet" href="{% static 'font-awesome-4.7.0/css/font-awesome.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/soulTable.css' %}">
    <link rel="stylesheet" href="{% static 'css/reportDetail.css' %}">

    <script src="http://cdn.highcharts.com.cn/highcharts/highcharts.js"></script>
    <script src="{% static 'jquery-3.4.1/jquery-3.4.1.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/echarts.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'layui2.5.5/layui.js' %}"></script>
    <script>
        var parentId = '{{ parentId }}';
    </script>
    <script src="{% static 'js/reportDetail.js' %}"></script>
</head>

<body>

<div>
    <!--树加滚动条overflow: scroll;-->
    <div class="zzh">
        <!--树-->
        <div id="caseset"></div>
        <div id="cases"></div>
        <div id="container" style="min-width:400px;height:400px;"></div>
        <div class="return"><a class="layui-btn layui-btn-sm" href="/interface_test_report">返回上一级</a></div>
        <div id="test" class="demo-tree demo-tree-box treetable"></div>
        <div class="treetable mytable">
            <!--表格-->
            <table id="treetable" lay-filter="treetable"></table>
        </div>
    </div>
</div>


{#表头按钮#}
<script type="text/html" id="toolbarDemo">
    <div class="layui-btn-container">
        <button class="layui-btn layui-btn-sm" lay-event="export_report">导出图表</button>
    </div>
</script>

<script>
    // 绘制图表。
var caseset = echarts.init(document.getElementById('caseset'));
caseset.setOption({
    visualMap: {
        show: false,
        min: 80,
        max: 600,
        inRange: {
            colorLightness: [0, 1]
        }
    },
    title:{
        text:"用例集数据统计",
        left:"center"
    },
    tooltip: {
        trigger: 'item',
        formatter: '{a} <br/>{b} : {c} ({d}%)'
    },
    legend: {
        orient: 'vertical',
        left: 'left',
        data: ['成功', '失败']
    },
    series : [
        {
            name: '用例集成功率',
            type: 'pie',
            radius: '50%',
            center:["50%","50%"],
            data:[],
            emphasis: {
                itemStyle: {
                    shadowBlur: 10,
                    shadowOffsetX: 0,
                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                }
            },
            label: {
                normal: {
                    textStyle: {
                        color: 'rgba(0, 0, 0)'
                    }
                }
            },
            labelLine: {
                normal: {
                    lineStyle: {
                        color: 'rgba(0,0,0)'
                    }
                }
            }
        }
    ]
});
// 异步加载数据
$.ajax({
    url: "/api/v1/report_detail/echarts/",
    type: 'GET',
    data: {
        "parentId":parentId
    },
    //请求前的处理,加载loading
    success: function (data) {
        console.log(data);
        //更新series
        //cases.setOption({
        //    series: [{
        //        // 根据名字对应到相应的系列
        //        data: data[1]
        //    }]
        //});
        caseset.setOption({
            series: [{
                // 根据名字对应到相应的系列
                data: data[0]
            }]
        });
    },
    error: function (data) {
        console.log(data);
        alert("出错了，请查看控制台！")

    }
});

var cases = echarts.init(document.getElementById('cases'));
cases.setOption({
    visualMap: {
        show: false,
        min: 80,
        max: 600,
        inRange: {
            colorLightness: [0, 1]
        }
    },
    title:{
        text:"用例数据统计",
        x:"center",
        size:"16px"
    },
    series : [
        {
            name: '用例成功率',
            type: 'pie',
            radius: '50%',
            center:["50%","50%"],
            data:[{"value":2,"name":"成功:2"},{"value":1,"name":"失败:1"}],
            label: {
                normal: {
                    textStyle: {
                        color: 'rgba(0, 0, 0)'
                    }
                }
            },
            labelLine: {
                normal: {
                    lineStyle: {
                        color: 'rgba(0,0,0)'
                    }
                }
            }
        }
    ]
});
</script>

<script>
    Highcharts.chart('container', {
	chart: {
		plotBackgroundColor: null,
		plotBorderWidth: null,
		plotShadow: false,
		type: 'pie'
	},
	title: {
		text: '2018年1月浏览器市场份额'
	},
	tooltip: {
		pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
	},
	plotOptions: {
		pie: {
			allowPointSelect: true,
			cursor: 'pointer',
			dataLabels: {
				enabled: true,
				format: '<b>{point.name}</b>: {point.percentage:.1f} %',
				style: {
					color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
				}
			}
		}
	},
	series: [{
		name: 'Brands',
		colorByPoint: true,
		data: [{
			name: 'Chrome',
			y: 61.41,
			sliced: true,
			selected: true
		}, {
			name: 'Internet Explorer',
			y: 11.84
		}, {
			name: 'Firefox',
			y: 10.85
		}, {
			name: 'Edge',
			y: 4.67
		}, {
			name: 'Safari',
			y: 4.18
		}, {
			name: 'Sogou Explorer',
			y: 1.64
		}, {
			name: 'Opera',
			y: 1.6
		}, {
			name: 'QQ',
			y: 1.2
		}, {
			name: 'Other',
			y: 2.61
		}]
	}]
});
</script>
</body>

</html>